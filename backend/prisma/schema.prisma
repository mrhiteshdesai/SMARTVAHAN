generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String     @id @default(uuid())
  name      String
  email     String?    @unique
  phone     String     @unique
  password  String
  role      UserRole
  status    UserStatus @default(ACTIVE)
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  oemCode   String?
  stateCode String?
  auditLogs AuditLog[]
  oem       OEM?       @relation(fields: [oemCode], references: [code])
  state     State?     @relation(fields: [stateCode], references: [code])

  @@map("users")
}

model State {
  code      String   @id
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  batches   Batch[]
  dealers   Dealer[]
  rtos      RTO[]
  users     User[]

  @@map("states")
}

model RTO {
  code      String   @id
  name      String
  stateCode String
  dealers   Dealer[]
  state     State    @relation(fields: [stateCode], references: [code])

  @@map("rtos")
}

model OEM {
  id               String    @id @default(uuid())
  name             String
  code             String    @unique
  authorizedStates String[]
  copDocument      String?
  copValidity      DateTime?
  logo             String?
  batches          Batch[]
  users            User[]
  dealers          Dealer[]  @relation("DealerToOEM")

  @@map("oems")
}

model Dealer {
  id                  String         @id @default(uuid())
  name                String
  phone               String         @unique
  password            String
  status              UserStatus     @default(ACTIVE)
  stateCode           String
  rtoCode             String?
  locationAddress     String?
  city                String?
  zip                 String?
  latitude            Float?
  longitude           Float?
  radius              Float?         @default(10)
  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt
  allRTOs             Boolean        @default(false)
  gstNo               String?
  tradeCertificateNo  String?
  tradeValidity       DateTime?
  aadharCardUrl       String?
  aadharNumber        String?
  gstCertificateUrl   String?
  tradeCertificateUrl String?
  certificates        Certificate[]
  rto                 RTO?           @relation(fields: [rtoCode], references: [code])
  state               State          @relation(fields: [stateCode], references: [code])
  inventoryLogs       InventoryLog[]
  oems                OEM[]          @relation("DealerToOEM")

  @@map("dealers")
}

model VehicleManufacturer {
  id        String   @id @default(uuid())
  name      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("vehicle_manufacturers")
}

model VehicleCategory {
  id        String   @id @default(uuid())
  name      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("vehicle_categories")
}

model Product {
  code      String   @id
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  batches   Batch[]

  @@map("products")
}

model Batch {
  id          String   @id @default(uuid())
  batchId     String   @unique
  userId      String?
  pcBindingId String?
  stateCode   String
  oemCode     String
  productCode String
  quantity    Int
  startSerial String?
  endSerial   String?
  status      String   @default("PENDING")
  filePath    String?
  createdAt   DateTime @default(now())
  oem         OEM      @relation(fields: [oemCode], references: [code])
  product     Product  @relation(fields: [productCode], references: [code])
  state       State    @relation(fields: [stateCode], references: [code])
  qrCodes     QRCode[]

  @@map("batches")
}

model QRCode {
  id           String       @id @default(uuid())
  value        String       @unique
  fullUrl      String
  serialNumber Int
  status       Int          @default(0)
  count        Int          @default(1)
  batchId      String
  createdAt    DateTime     @default(now())
  certificate  Certificate?
  batch        Batch        @relation(fields: [batchId], references: [id], onDelete: Cascade)

  @@map("qr_codes")
}

model Certificate {
  id                String   @id @default(uuid())
  certificateNumber String   @unique
  qrCodeId          String   @unique
  vehicleMake       String
  vehicleCategory   String
  fuelType          String
  passingRto        String
  registrationRto   String
  series            String?
  manufacturingYear String
  chassisNumber     String
  engineNumber      String
  ownerName         String
  ownerContact      String
  photoFrontLeft    String
  photoBackRight    String
  photoNumberPlate  String
  photoRc           String
  pdfPath           String
  vehicleNumber     String
  count             Int      @default(1)
  generatedAt       DateTime @default(now())
  locationText      String?
  dealerId          String?
  dealer            Dealer?  @relation(fields: [dealerId], references: [id])
  qrCode            QRCode   @relation(fields: [qrCodeId], references: [id], onDelete: Cascade)

  @@map("certificates")
}

model Sequence {
  id    String @id
  value Int

  @@map("sequences")
}

model ManufacturingYear {
  year      Int      @id
  createdAt DateTime @default(now())

  @@map("manufacturing_years")
}

model SystemSettings {
  id              String   @id @default("SYSTEM_SETTINGS")
  systemName      String   @default("SMARTVAHAN")
  systemLogo      String?
  primaryColor    String   @default("#4F46E5")
  dateFormat      String   @default("DD/MM/YYYY")
  googlePlacesKey String?
  awsAccessKey    String?
  awsSecretKey    String?
  awsRegion       String?
  awsBucket       String?
  updatedAt       DateTime @updatedAt

  @@map("system_settings")
}

model AuditLog {
  id        String   @id @default(uuid())
  action    String
  entity    String
  entityId  String?
  details   String?
  userId    String?
  ipAddress String?
  timestamp DateTime @default(now())
  user      User?    @relation(fields: [userId], references: [id])

  @@map("audit_logs")
}

model InventoryLog {
  id          String   @id @default(uuid())
  type        String
  stateCode   String
  oemCode     String
  productCode String
  quantity    Int
  serialStart String?
  serialEnd   String?
  remark      String?
  batchId     String?
  userId      String?
  createdAt   DateTime @default(now())
  dealerId    String?
  dealer      Dealer?  @relation(fields: [dealerId], references: [id])

  @@map("inventory_logs")
}

enum UserRole {
  SUPER_ADMIN
  STATE_ADMIN
  OEM_ADMIN
  DEALER_USER
  ADMIN
}

enum UserStatus {
  ACTIVE
  INACTIVE
}
